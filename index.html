<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gloebit</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <a name="top"></a>
    <div class="wrapper">
      <header>
        <h1>Gloebit</h1>
        <p></p>

        <p class="view"><a href="#top">Top</a></p>
        <p class="view"><a href="#examples">Examples</a></p>

      </header>
      <section>
        <h3>
          <a name="gloebit" class="anchor" href="#gloebit">
            <span class="octicon octicon-link"></span>
          </a>
          Gloebit
        </h3>

        <p>Gloebit is a service that makes microtransactions easy.  Gloebit can
        help with:</p>

        <ul>
          <li> managing user accounts
          <li> collecting payments
          <li> keeping track of users' entitlements
        </ul>


        <p>User and merchants create accounts on Gloebit's website.  An
        application associated with a merchant account uses OAuth2 to get a
        user's permission to interacts with their account.</p>

        <p>Users purchase gloebits on Gloebit's website -- Gloebit
        takes care of interfacing with various payment providers.  Once a user
        has a balance of gloebits, an application can exchange entitlements or
        digital inventory for the user's gloebits.</p>

        <img src="https://s3.amazonaws.com/gloebit/gloebit-overview.png"/>

        <a name="examples"></a>
        <h3>Code examples:</h3>

        <ul>
          <li><a href="https://github.com/gloebit/python-django-gloebit">Python</a>
          <li><a href="https://github.com/gloebit/PHP-gloebit">PHP</a>
          <li><a href="https://github.com/gloebit/unity-gloebit">Unity Webplayer</a>
          <li><a href="https://github.com/gloebit/haxe-gloebit">HAXE</a>
        </ul>

        <h1 id="oauth-api">OAuth API</h1>


        <p>Your application or website can interact with Gloebit user-accounts
        by using Gloebit&rsquo;s API.</p>

        <p>To interact with a user&rsquo;s Gloebit account, the user must grant
        permission.  Your application sends the user&rsquo;s browser to Gloebit&rsquo;s
        website where the user is presented with a permission dialog.  If the
        user agrees, a token is sent back to your application.  Your
        application includes the token with API requests to prove that the
        user has allowed access to their account.</p>

        <p>The API allows various operations, such as querying the user&rsquo;s balance
        or initiating transactions between the user and your application.</p>

        <p>Either OAuth 1.0a or OAuth 2.0 is used for authentication.
        Any data delivered to or received from API requests will have a
        Content-Type of <strong>application/json</strong>.  All requests go over https.</p>

        <h2 id="oauth-1.0a">OAuth 1.0a</h2>

        <p>There are many <a href="http://oauth.net/code/">client libraries</a>
        for <a href="http://oauth.net/core/1.0a/">OAuth 1.0a</a>.</p>

        <p>The request-token url can be modified with an optional &ldquo;user&rdquo;
        query-arg.  If provided, it should be the username of the account on
        the consumer side (the username as your application knows it).  It
        will be recorded in the token and used for display purposes, only.</p>

        <table><thead>
          <tr>
            <th>operation</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>Request Token</td>
            <td>https://www.gloebit.com/oauth/request-token</td>
          </tr>
          <tr>
            <td>Authorize</td>
            <td>https://www.gloebit.com/oauth/authorize</td>
          </tr>
          <tr>
            <td>Access Token</td>
            <td>https://www.gloebit.com/oauth/access-token</td>
          </tr>
        </tbody></table>

        <p><img src="images/oauth1-seq.png" height="812"></p>

        <p>The application first gets a <em>Request Token</em> from Gloebit.  This
        token isn&rsquo;t associated with a particular user or domain.  Next,
        the application sends the user to Gloebit&rsquo;s authorization page.  If
        the user agrees to grant access, the <em>Request Token</em> is authorized
        and a specific user and domain are associated with it.  Next, the
        application exchanges the authorized <em>Request Token</em> for an <em>Access Token</em>.
        The <em>Access Token</em> is used during API requests.</p>

        <h2 id="oauth-2.0">OAuth 2.0</h2>

        <p>Gloebit supports three-legged <a href="http://oauth.net/2/">OAuth 2.0</a>.</p>

        <p>The authorize url should be modified with some query args:</p>

        <table><thead>
          <tr>
            <th>query argument</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>client_id</td>
            <td>the consumer (application / 3rd party) key</td>
          </tr>
          <tr>
            <td>response_type</td>
            <td>Gloebit only uses &ldquo;code&rdquo; response type.</td>
          </tr>
          <tr>
            <td>redirect_uri</td>
            <td>Where to send the user after the permission dialog.</td>
          </tr>
          <tr>
            <td>scope</td>
            <td>a space separated list of what permissions are being requested.</td>
          </tr>
          <tr>
            <td>user</td>
            <td>an optional argument.  If provided, it should be the username of the account on the consumer side.  It will be recorded in the token and used for display purposes, only.</td>
          </tr>
        </tbody></table>

        <p>Once the user grants permission, they will be redirected back to the
        <em>redirect_uri</em> with a <em>code</em> query-arg.</p>

        <p>Authorization</p>

        <table><thead>
          <tr>
            <th>operation</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>Access-Token</td>
            <td>https://www.gloebit.com/oauth2/access-token</td>
          </tr>
          <tr>
            <td>Authorize</td>
            <td>https://www.gloebit.com/oauth2/authorize</td>
          </tr>
        </tbody></table>

        <p>Overview of OAuth 2.0 Flow:<br>
        <img src="images/oauth2-seq.png" height="506"></p>

        <p>The application sends the user to Gloebit&rsquo;s
        authorization page.  Once the user has agreed, a token id (the
        <em>code</em> query arguement) is included and the user is
        sent to the <em>redirect_uri</em>.  The application then
        validates the token. The token is used as the value of the
        <strong>Authorization</strong> HTTP header during any API
        requests.</p>

        <h1 id="domain/scope">Domain/Scope</h1>

        <p>When retrieving OAuth tokens, use these strings for the domain (for
        OAuth 1.0a) or scope (for OAuth 2.0).  The value should be one string
        containing space separated parts.</p>

        <table><thead>
          <tr>
            <th>domain name</th>
            <th>endpoints</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>id</td>
            <td>The authorization dialog will be Gloebit&rsquo;s character creation/selection dialog rather than the access request dialog.</td>
          </tr>
          <tr>
            <td>balance</td>
            <td>Allows use of the <em>Balance</em> endpoint.</td>
          </tr>
          <tr>
            <td>transact</td>
            <td>Allows use of the <em>Transact</em> endpoint.</td>
          </tr>
          <tr>
            <td>inventory</td>
            <td>Allows use of the <em>Inventory</em> endpoints.</td>
          </tr>
        </tbody></table>

        <h1 id="account-endpoints">Account Endpoints</h1>

        <p>These API endpoints require a valid access-token.
        The domain/scope of the access-token must be appropriate for
        whichever request is being made.</p>


        <h2 id="identity">Identity</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>id</td>
            <td>https://www.gloebit.com/id</td>
          </tr>
        </tbody></table>

        <p>When the domain/scope includes <strong>id</strong>,
        a character creation/selection dialog is used during the
        authorization step of the OAuth flow.  The selected character
        will determine the values in the response to this request.</p>

        <h3 id="response">response</h3>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>id</td>
            <td>UUID for whichever character the user selected.</td>
          </tr>
          <tr>
            <td>name</td>
            <td>Name of the selected character.</td>
          </tr>
          <tr>
            <td>params</td>
            <td>dictionary of parameters associated with the selected character.</td>
          </tr>
        </tbody></table>

        <h2 id="balance">Balance</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>balance</td>
            <td>https://www.gloebit.com/balance</td>
          </tr>
        </tbody></table>

        <h3 id="response">Response</h3>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>explanation of (lack of) success</td>
          </tr>
          <tr>
            <td>balance</td>
            <td>user&rsquo;s G$ balance</td>
          </tr>
        </tbody></table>

        <h2 id="transact">Transact</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>transact</td>
            <td>https://www.gloebit.com/transact</td>
          </tr>
        </tbody></table>

        <p>Check validity of a merchant&rsquo;s transaction
        request and then put it into the inbound queue.</p>

        <p>The post body should be a json dictionary with these keys:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>version</td>
            <td>integer, 1</td>
          </tr>
          <tr>
            <td>id</td>
            <td>string, transaction id, generated by client</td>
          </tr>
          <tr>
            <td>request-created</td>
            <td>integer, seconds since 1970</td>
          </tr>
          <tr>
            <td>asset-code</td>
            <td>string</td>
          </tr>
          <tr>
            <td>asset-quantity</td>
            <td>integer</td>
          </tr>
          <tr>
            <td>asset-enact-hold-url</td>
            <td>string or None</td>
          </tr>
          <tr>
            <td>asset-consume-hold-url</td>
            <td>string or None</td>
          </tr>
          <tr>
            <td>asset-cancel-hold-url</td>
            <td>string or None</td>
          </tr>
          <tr>
            <td>gloebit-balance-change</td>
            <td>number of G$ to charge the user.</td>
          </tr>
          <tr>
            <td>gloebit-recipient-user-name</td>
            <td>string, recipient&rsquo;s username</td>
          </tr>
          <tr>
            <td>consumer-key</td>
            <td>string</td>
          </tr>
          <tr>
            <td>merchant-user-id</td>
            <td>string, merchant&rsquo;s local id for this user</td>
          </tr>
        </tbody></table>

        <p>The response will also be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>id</td>
            <td>string, same as request</td>
          </tr>
          <tr>
            <td>status</td>
            <td>string, one of &ldquo;queued&rdquo;, &ldquo;queuing-failed&rdquo;, &ldquo;in-progress&rdquo;</td>
          </tr>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>string, human readable explaination of status</td>
          </tr>
        </tbody></table>

        <h1 id="inventory-endpoints">Inventory Endpoints</h1>

        <p>Inventory operations are per gloebit user, not per
        character.  If per-character inventory is desired, use the
        character-id as a top-level folder.</p>

        <h2 id="new-inventory-item">New Inventory Item</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>inventory</td>
            <td>https://www.gloebit.com/new-inventory-item</td>
          </tr>
        </tbody></table>

        <p>Create a new inventory item.  Folder-id is optional and will
        default to a null uuid.</p>

        <p>The request body should be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>folder-id</td>
            <td>string</td>
          </tr>
          <tr>
            <td>type-id</td>
            <td>string</td>
          </tr>
          <tr>
            <td>params</td>
            <td>a dictionary</td>
          </tr>
        </tbody></table>

        <p>The response will be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>string</td>
          </tr>
          <tr>
            <td>item-id</td>
            <td>string (uuid)</td>
          </tr>
        </tbody></table>

        <h2 id="list-inventory-items">List Inventory Items</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>inventory</td>
            <td>https://www.gloebit.com/get-inventory-item-ids</td>
          </tr>
          <tr>
            <td>inventory</td>
            <td>https://www.gloebit.com/get-inventory-item-ids/*folder-id*</td>
          </tr>
        </tbody></table>

        <p>Retrieve a list of inventory item IDs for a user.</p>

        <p>The response will be a json dictionary.</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>string</td>
          </tr>
          <tr>
            <td>item-ids</td>
            <td>json array &ndash; Each element is a tuple of strings: (item-type-id, item-id, folder-id).</td>
          </tr>
        </tbody></table>

        <p>If folder-id isn&rsquo;t specified, the entire
        inventory for the authorized user is returned.  If a folder-id
        is given, only inventory items from that folder are returned.
        The root folder for a user is identified with a null UUID:
        &ldquo;00000000-0000-0000-0000-000000000000&rdquo;.</p>

        <h2 id="get-inventory-item">Get Inventory Item</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>inventory</td>
            <td>https://www.gloebit.com/get-inventory-item/*item-id*</td>
          </tr>
        </tbody></table>

        <p>Retrieve details about a user&rsquo;s inventory item.</p>

        <p>The response will be a json dictionary:</p>

        <p>The request body should be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>string</td>
          </tr>
          <tr>
            <td>item</td>
            <td>details about inventory item</td>
          </tr>
        </tbody></table>

        <h2 id="update-inventory-item-parameters">Update Inventory Item Parameters</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>inventory</td>
            <td>https://www.gloebit.com/update-inventory-item-params</td>
          </tr>
        </tbody></table>

        <p>Change details about a user&rsquo;s inventory item.  If the
        item isn&rsquo;t found, a new one will be created.</p>

        <p>The request body should be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>id</td>
            <td>string</td>
          </tr>
          <tr>
            <td>folder-id</td>
            <td>string</td>
          </tr>
          <tr>
            <td>type-id</td>
            <td>string</td>
          </tr>
          <tr>
            <td>params</td>
            <td>a dictionary</td>
          </tr>
        </tbody></table>

        <p>The response will be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>string</td>
          </tr>
        </tbody></table>

        <h2 id="delete-inventory-item">Delete Inventory Item</h2>

        <table><thead>
          <tr>
            <th>domain</th>
            <th>endpoint</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>inventory</td>
            <td>https://www.gloebit.com/delete-inventory-item/*item-id*</td>
          </tr>
        </tbody></table>

        <p>Delete a user&rsquo;s inventory item.</p>

        <p>The response will be a json dictionary:</p>

        <table><thead>
          <tr>
            <th>key</th>
            <th>value</th>
          </tr>
          </thead><tbody>
          <tr>
            <td>success</td>
            <td>boolean</td>
          </tr>
          <tr>
            <td>reason</td>
            <td>string</td>
          </tr>
        </tbody></table>

        <h1 id="errors">Errors</h1>

        <p>Any access-token protected API call returns a json
        dictionary.  One of the entries will be &lsquo;success&rsquo;
        which will be True or False.  If &lsquo;success&rsquo; is
        False, there will be an entry called &lsquo;reason&rsquo;,
        which will be set to one of:</p>

        <ul>
          <li>missing domain</li>
          <li>unknown consumer</li>
          <li>unknown user</li>
          <li>unknown token</li>
          <li>token has expired</li>
        </ul>


      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
